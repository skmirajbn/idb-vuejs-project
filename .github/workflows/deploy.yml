name: Deploy to VPS

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy using SSH
        run: |
          $secpasswd = ConvertTo-SecureString $env:SSH_PRIVATE_KEY -AsPlainText -Force
          $key = New-Object System.Management.Automation.PSCredential($env:USERNAME, $secpasswd)

          ssh -i $key -p $env:PORT $env:USERNAME@$env:HOST "cd C:\websites\skmiraj\VueJs\idb-vuejs-project ; git pull"
        env:
          HOST: ${{ secrets.HOST }}
          USERNAME: ${{ secrets.USERNAME }}
          PORT: ${{ secrets.PORT }}
          SSH_PRIVATE_KEY: ${{ secrets.PRIVATE_KEY }}
